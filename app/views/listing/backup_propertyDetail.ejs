<!DOCTYPE html>
<html lang="en">
  <head>
    <% include ../frontend/template/head %>     
  </head>
  <body>    
    <% include ../frontend/template/subnav %>
    <% var page=parseInt(page);
          var isLoggedIn;
           if(req.session.user && req.session.user.user_type==2){
           isLoggedIn=1;
           }else{
           isLoggedIn=0;
           }

           var is_usertype=0;
           if(req.session.user){
              if(req.session.user.user_type==2){
                is_usertype=2;
              }else if(req.session.user.user_type==1){
                is_usertype=1;
              }else{
                is_usertype=3;
              }
           }else{
              is_usertype=0;
           }

          in_array = function(val, arrayList){ 
                var flag=0;
                arrayList.forEach(function(el){
                  if(el==val) flag++;
                  });
                 return (flag>0) ? 'active' : '';
              }
          review_active_class = function(val, arrayList){
                var flag=0;
                arrayList.forEach(function(el){
                console.log(el.review);
                console.log(val);
                  if(el.review.equals(val) && el.user.equals(req.session.user._id)){ 
                    flag=1;
                  }
                  });
                  console.log("flag "+flag)
              return (flag>0) ? 'active' : '';
          }
          if(req.session.user && req.header('Referer')==req.url){
          backpageUrl='MyListing';
          }else{
          backpageUrl=req.header('Referer');
          }
    %>
<section class="location-page-daital">
  <div class="container">
      <!-- <div class="row margin-5">
        
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 claim-section">            
          <%  if(req.session.user){
              if(property.user_type==1 && (req.session.user.user_type==2 && session.user.status==2)){ %>
          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 claim-section">
            <% if(claimStatus==1){ %>
            <button class="btn-primary btn pull-right" id="unClaimBtn" data-property-id="<%=claimId%>">Unclaim</button>
            <% }else{ %>
            <button class="btn-success btn pull-right" id="claimBtn" data-property-id="<%=property.id%>">Claim </button>
            <% } %>
          </div>
        <% }  } %>
        </div>
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <% include ../frontend/template/error %>
        </div>
      </div> -->
    <div class="row">
      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
        <div class="location_silider">
          <div class="main">
            <div class="slider slider-for">
                <%
                  var property_images = [];
                  if(property.property_images.length>0){
                    property_images = property.property_images.split(',');
                  }else{
                    property_images[0] = "no-location.jpg";
                  }
                  property_images.forEach(function(image, index) { %>
                      <%
                      if(property.property_images.length>0){%>
                      <div class="slid-post"><img src="../../uploads/thumbs/thumb_<%=image%>"></div>                  
                      <%}else{%>
                      <div class="slid-post"><img src="../../uploads/thumbs/thumb_<%=image%>"></div>
                      <%}
                      %>
                  <% });%>
            </div>
            <div class="slider slider-nav">
              <%
              var property_images = [];
              if(property.property_images.length>0){
                property_images = property.property_images.split(',');
              }else{
                property_images[0] = "no-location.jpg";
              }
              property_images.forEach(function(image, index) { %>
              <%
                if(property.property_images.length>0){%>
                  <div class="slid-post1"><img src="../../uploads/thumbs/thumb_<%=image%>"></div>                  
                <%}else{%>
                  <div class="slid-post1"><img src="../../uploads/thumbs/thumb_<%=image%>"></div>
                <%}
                %>
            <% });%>
            </div>
          </div>
        </div>
      </div>
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
          <div class="lombart-sec">
            <div class="lombart-text">
              <h2 class="text-left"><%-property.property_name%></h2>
              <!-- <p class="content-add property-add"><%-property.address1%> <%-property.address2%> <%-property.post_code%></p>
              <p class="content-category property-cat"><%-property.category_name%></p> --> 
            </div>
            <div class="reviews-text">
              <ul>
                <li><span>1.0<i class="fa fa-star" aria-hidden="true"></i></span></li>
                <li><%-property.total_reviews %> Reviews</li>
                <li>
                    <p><i class="fa fa-signal" aria-hidden="true"></i> Detail</p>
                </li>
                <% if(req.session.user){ %>
                <% if(isFollowed==0){ %>
                <li><a href="<%- base_url+'/user/location/follow/'+property._id%>">Follow</a></li>
                 <% } else{ %>
                 <li><a href="javascript:void(0)" onclick="confirmmessage('Are you sure you want to Unfollow this location?','/user/location/unfollow/<%-property._id%>')">UnFollow</a></li>
                 <% } } %>
                 </ul>
              </div>

              <div class="location_bt">
                <ul>
                  <li><span><i class="fa fa-map-marker" aria-hidden="true"></i></span><%-property.address1%> <%-property.address2%> <%-property.post_code%></li>
                  <li><span><i class="fa fa-tag" aria-hidden="true"></i></span><%-property.category_name%></li>
                  <li><img src="<%-base_url%>/images/verifide-icon.png"></li>
                </ul>
              </div>

              <div class="bounty_post">
                <img src="<%-base_url%>/images/bounty.png">
              </div>

                <div class="location-check">
                  <% if(req.session.user){%>
                  <%if(req.session.user.user_type==1){%>
                  <!-- <button class="in-check-bt">Check in</button> -->
                  <a href="javascript:void(0)" class="checkInbtn in-check-bt">Check In</a>
                  <button class="in-check-bt"><span><i class="fa fa-star" aria-hidden="true"></i></span> Write a Review</button>
               <%} }%>
             </div> 
            </div>
          </div>
        </div>
      </div>
    </section> 
<!-- location-page-daital end -->
    
        <!-- description-sec strat --> 
        <section class="description-sec">
          <div class="container">
            <div class="row">
              <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="title-ds">
                  <h2 class="border-bottom">Description</h2>
                    <p class="desc-text text-justify"><%-property.property_desc%></p>
                 </div>
                </div>
              </div>
            </div>
        </section>
        <!-- description-sec end --> 

        <!-- our_products-sec strat -->
        <%if(req.session.user){%>
        <%if(req.session.user.user_type==2){%>
        <section class="our_products-sec">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="title-ds">
                        <h2>Our Products <a href="#" class="view_more_pro">View More Products</a></h2>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                    <div class="Products-post">
                     <div class="post-products" 
                     style="background-image: url(<%-base_url%>/images/pizza_hut_voucher_img.png);"></div>
                        

                        <h2><a href="#">Pizza Hut Voucher</a></h2>
                        <p>token price <span>20 stt</span></p>

                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                    <div class="Products-post">
                        <div class="post-products " style="background-image: url(<%-base_url%>/images/plazmatic_gift_card_img.png);
              "></div>

                        <h2><a href="#">Plazmatic Gift Card</a></h2>
                        <p>token price <span>20 stt</span></p>

                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                    <div class="Products-post">
                        <div class="post-products " style="background-image: url(<%-base_url%>/images/McDonald’s_gift_card_img.png);
             "></div>

                        <h2><a href="#">McDonald's Gift Card</a></h2>
                        <p>token price <span>20 stt</span></p>

                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                    <div class="Products-post">
                        <div class="post-products " style="background-image: url(<%-base_url%>/images/levi’s_gift_card_img.png);
              "></div>

                        <h2><a href="#">Levi's Gift Card</a></h2>
                        <p>token price <span>20 stt</span></p>

                    </div>
                </div>
            </div>
        </div>
    </section>  
      <% } } %>
<!-- our_products-sec end -->

 

<!-- check_ins section strat -->
<section class="check_ins">
    <div class="container ">
        <% property.reviews.forEach(function(review, index){ %>
        <div class="row border-bottom ">           
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 no_padding">
                <div class="title-ds">
                    <h2>Reviews and Check-ins</h2>
                </div>
            </div>

            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                <div class="input-group stylish-input-group search-bt">
                    <span>                        
                     <i class="fa fa-search" aria-hidden="true"></i>                        
                    </span>
                    <input type="text" class="form-control" placeholder="Search review">

                </div>
            </div>
           <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
             <div class="select_reviews">
                    <select class="form-control">
                      <option>Sort by</option>
                      <option>2</option>
                      <option>3</option>
                      <option>4</option>
                      <option>5</option>
                    </select>
              </div>
           </div>
       </div>  
    </div>
    <div class="container">
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no_padding">
            <div class="comment-text">
            <%if(is_usertype==2 && property.user_id==req.session.user.id){%>
              <%if(review.is_guest==1){%>
                <h3><%-review.first_name%> <%-review.last_name%></h3>
              <%}else{%>
                <h3>Anonymous (<%-review.first_name%> <%-review.last_name%>)</h3>
              <%}%>  
            <%}else{%>
              <%if(review.is_guest==1){%>
                <h3><%-review.first_name%> <%-review.last_name%></h3>
              <%}else{%>
            <h2>Anonymous</h2>
             <%}%>
            <%}%>
            <div class="testi-star-rating">
              <div class="stars">
                <% var i=0;
                for(i=0;i<parseInt(review.review_rating);i++){ %>
                <span class="star-o"></span>  
                <% }
                for(;i<5;i++){  %>
                <span class="star-half-o"></span>
                <% } %>
              </div>
            </div>
            <ul>
            <li><span>1.0 <i class="fa fa-star" aria-hidden="true"></i></span></li>
            <li><%-review.created_date %></li>
            <%if(req.session.user){%>
            <%if(req.session.user.id==review.user_id){%>
            <li><a href="#"><i class="fa fa-trash delReview" id="<%=review.id%>" aria-hidden="true"></i></a></li>
            <li><a href="#"><i class="fa fa-pencil-square-o editReview" id="<%=review.id%>" aria-hidden="true"></i></a></li>
            <%}}%>             
          </ul>
        
           <p><%=review.review_content %></p>
          <% if(is_usertype==2 && property.user_id==req.session.user.id){ %>
            <p class="testimonial-text">IP: <%=review.ip_address%> | <%=review.user_location%></p>
          <% } %>
           <div class="share-icon shareBox">             
               <!-- <a href="#"><i class="fa fa-share-alt" aria-hidden="true"></i></a> -->

                <a class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-share-alt" aria-hidden="true"></i><span class="share"></span></a>
                <ul class="dropdown-menu">
                  <li class="share_fb"><a data-service="facebook" title="share facebook" data-title="share facebook" href="/sharefacebook?review=<%=review.review_content %>"><i class="fa fa-facebook-official"> Facebook</i></a></li>
                  <li class="share_twitter"><a data-service="twitter" title="share twitter" data-title="share twitter" href="/sharetwitter?review=<%=review.review_content %>"><i class="fa fa-twitter"> Twitter</i> </a></li>
                </ul>
                </a>    
               <!-- <a href="#" class="active"><i class="fa fa-thumbs-o-up" aria-hidden="true"></i></a> -->
               <% if(req.session.user && req.session.user.user_type==1){ %>
                 <a href="#"><i class="fa fa-thumbs-o-up" aria-hidden="true"><span class="like foundHelpful <%-review_active_class(review._id, likedReviews)%>" data-status="<%-in_array(review._id, req.session.likedReviews)%>" data-reviewId="<%-review._id %>" data-propertyId="<%-property._id %>" data-flagId="0" title="Found it helpful"></span></i></a>
                 <%}else if(req.session.user && req.session.user.user_type==2){%>
                   <a href="#"><i class="fa fa-thumbs-o-up" aria-hidden="true"><span class="like foundHelpful1" title="As a business, you can not like any reviews"></span></i></a>
                 <%}else{%>
                 <a href="#"><i class="fa fa-thumbs-o-up" aria-hidden="true"><span class="like foundHelpful1" title="Found it helpful, Login required"></span></i></a>
                 <%}%>
               <a href="#"><i class="fa fa-exclamation-circle" aria-hidden="true"></i></a>
               <% if(req.session.user){ %>
                  <span class="social-info flagThis <%-review_active_class(review.id, req.session.flagedReviews)%>" data-status="<%-in_array(review.id, req.session.flagedReviews)%>" data-reviewId="<%-review.id %>" data-propertyId="<%-property.id %>" data-flagId="0" title="Report review"></span>
                <%}else{%>
                  <span class="social-info flagThis1" title="Report review, Login required"></span>
                <%}%>
                <%if(is_usertype==2){
                if(req.session.user.id==property.user_id){
                %>
                 <span class="social-info replay-btn replyToReview" title="Review reply" id="replyToReview<%=review.id %>" data-reviewid="<%=review.id %>"></span>
                <%} }%>
                <div class="media-images text-center view_review">
                  <%if(review.review_media!=''){%>
                   <a href="#image-content<%-review.id %>" class="create-slider btn-primary " data-media="<%-review.review_media %>">View</a>
                <%}%>

              </div>
              <div class="testimonial-card" id="replyreviewcard<%=review.id %>" style="display: none;">
              <p><strong> Reply: </strong>
              <!-- <input type="text" name="replytext" id="replybox<%=review.id %>"value="<%-review.reply_text%>"> -->
              <textarea name="replytext" class="form-control form-group form-group-material" id="replybox<%=review.id %>"><%-review.reply_text%></textarea>
              <button type="button" data-id="<%=review.id %>" class="pull-right btn btn-primary btn-rounded btn-outline replyButton" data-prop="<%=property.id%>" id="replybtn<%=review.id %>">Reply</button>
              </p>
            </div>
            <% if(review.is_reply==1){ %>
           <div class="testimonial-card testimonial-reply">
            <%if(req.session.user){%>
              <%if(req.session.user.id==property.user_id){%>              
              <div class="crud-icons pull-right">
                    <button class="delete-btn delreplyReview" id="<%=review.id%>">delete</button>  

                    <button title="reply" class="edit-btn replyToReview" id="replyToReview<%=review.id %>" data-reviewid="<%=review.id %>">edit</button>   
              </div>
              <%}}%>
              <h3><%-property.property_name%></h3>
              <p class="date-time"><%-review.reply_created_date %></p>
              <div class="testi-content">
                <p class="testimonial-text"><i class="quote-left"></i><%-review.reply_text%><i class="quote-right"></i></p>
              </div>
           </div>
           <% } %>
           <% if(page){
          }else{
          page=0;
          } %>
          <%if(counter>5){ %> 
            <div class="row">
              <hr class="seprator">
                <ul class="pagination">
                  <li class="page-item" data-id="0"><a class="page-link" href="javascript:void(0)">First</a></li>
                  <%
                  var lastPage = Math.ceil(counter/5);
                  var last = lastPage - 1;
                  for(k=0;k<lastPage;k++){ %>
                  <li class="page-item <% if(page==k){ %> active <%}%>" data-id="<%=k%>"><a class="page-link" href="javascript:void(0)"><%=k+1%></a></li>
                  <% } %>
                  <li class="page-item" data-id="<%=last%>"><a class="page-link" href="javascript:void(0)">Last</a></li>
                </ul>            
            </div>
            <form method="get" action="location-details" id="property-details">
              <input type="hidden" name="id" value="<%-property.id%>" id="id">
              <input type="hidden" name="page" value="<%-page%>" id="page">
            </form>
            <input type="hidden" name="total_page" id="total_page" value="<%=Math.ceil(counter/10)%>">
            <% } %>
           </div>
          </div>
        <div class="read_more"><a href="#">Load More....</a></div>
          <% }); %>
          </div>
  </div>
</div>
</div>
</section>
<!-- check_ins section end -->
<% property.reviews.forEach(function(review, index){ %>
         
                      
          <% }) %>

    <div class="modal fade" id="editReviewModel" tabindex="-1" role="dialog" aria-labelledby="editReviewModalLabel" aria-hidden="true">
    <% include ../frontend/template/editreviewmodal %>  
    </div>
</div>
 

  <div class="modal fade" id="CheckInModel" tabindex="-1" role="dialog" aria-labelledby="CheckInModelLabel" aria-hidden="true">
      <% include ../frontend/template/checkinmodal %>  
      </div>
      </div>

  <div class="modal fade" id="addReviewModel" tabindex="-1" role="dialog" aria-labelledby="addReviewModalLabel" aria-hidden="true">
      <% include ../frontend/template/addreviewmodal %>  
  </div>

</div>

</div>
</div>
    <% include ../frontend/template/subfooter %>
    <script src="/js/validation/addreviewvalidation.js"></script>
    <script src="/js/validation/updatereviewvalidation.js"></script>
    <script src="/js/validation/checkinpropertyvalidation.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <script type="text/javascript">
    function disableButtons(counter_max, counter_current) {
        $('#show-previous-image, #show-next-image')
          .show();
        if (counter_max === counter_current) {
          $('#show-next-image')
            .hide();
        } else if (counter_current === 1) {
          $('#show-previous-image')
            .hide();
        }
    }

    $(document).ready(function(){
          $('.slider-for').slick({
            slidesToShow: 1,
            slidesToScroll: 1,
            arrows: false,
            fade: true,
            asNavFor: '.slider-nav'
          });
     
          $('.slider-nav').slick({
            slidesToShow: 5,
            slidesToScroll: 1,
            asNavFor: '.slider-for',
            dots: true,
            focusOnSelect: true
          });
    
          $('a[data-slide]').click(function(e) {
            e.preventDefault();
            var slideno = $(this).data('slide');
            $('.slider-nav').slick('slickGoTo', slideno - 1);
          });
      
          let modalId = $('#image-gallery');

          $('.in-check-bt').on('click',function(){
            $('#addReviewModel').modal();
          });
          
          loadGallery(true, 'a.thumbnail');
          //This function disables buttons when needed
        
          $('#show-next-image, #show-previous-image').click(function () {
            if ($(this).attr('id') === 'show-previous-image') {
              current_image--;
            } else {
              current_image++;
            }
  
            selector = $('[data-image-id="' + current_image + '"]');
            updateGallery(selector);
          });
               
          function updateGallery(selector) {
            let $sel = selector;
            current_image = $sel.data('image-id');
            $('#image-gallery-title')
              .text($sel.data('title'));
            $('#image-gallery-image')
              .attr('src', $sel.data('image'));
            disableButtons(counter, $sel.data('image-id'));
          }
          
          function loadGallery(setIDs, setClickAttr) {
              let current_image,
                selector,
                counter = 0;        
              if (setIDs == true) {
                $('[data-image-id]')
                  .each(function () {
                    counter++;
                    $(this)
                      .attr('data-image-id', counter);
                  });
              }
              $(setClickAttr).on('click', function () {
                  updateGallery($(this));
                });
            }
          });
        
        // build key actions
        $(document).keydown(function (e) {
            switch (e.which) {
              case 37: // left
                if ((modalId.data('bs.modal') || {})._isShown && $('#show-previous-image').is(":visible")) {
                  $('#show-previous-image')
                    .click();
                }
                break;
        
              case 39: // right
                if ((modalId.data('bs.modal') || {})._isShown && $('#show-next-image').is(":visible")) {
                  $('#show-next-image')
                    .click();
                }
                break;
        
              default:
                return; // exit this handler for other keys
            }
            e.preventDefault(); // prevent the default action (scroll / move caret)
          });

      /*$('#replyReviewform').submit(function(e){
          e.preventDefault();
          if(!($('#replyReviewform').valid())){
              console.log('form is invalid');
          }
          else{
            $.ajax({
              type: "POST",
              url: '/postreply',
              data: $('#replyReviewform').serialize(),
              success: function(data){
                if(data.status==true){
                  alert('review success');
                  //window.location.reload();
                }
              }
            });
          }
      });*/

      $('.replyButton').click(function(){        
        var reply_reviewid = $(this).attr('data-id');
        var propertyId = $(this).attr('data-prop');
        var review_id = $(this).attr('data-id');
        var review_reply = $("#replybox"+review_id).val();
        review_reply = review_reply.trim();
        if(!review_reply==''){
        $.ajax({
          type: "POST",
          url: '/postreply',
          data: {'review_reply':review_reply ,'propertyId':propertyId,'reply_reviewid':reply_reviewid},
            success: function(data){
              if(data.status==true){
                //alert('review success');
                window.location.reload();
              }
            }
          });
        }
        else{
          $($("#replybox"+review_id)).css({"border": "1px solid red"});
        }
      });

    function notLoggedIn(){
      swal({
            title: "Login required to add review",
            icon: "warning",
            buttons: true,
            buttons: ["Cancel", "Login"],
            dangerMode: true,
            closeOnClickOutside: false,
            closeOnEsc: false,
        }).then((willDelete) => {
            if (willDelete) {
                window.location.href = "/login";
            }else{
              window.location.reload();
            }
        });
      }

      $(".foundHelpful1, .flagThis1").click(function(){
         // notLoggedIn();
      });

      $('.editReview').click(function(){
        $('#dbreview_img').empty();
        $('.post-title input[type=radio]').parent().removeClass('checked');
        var review_id = this.id;
        $.ajax({
          method: 'get',
          url:'/getEditReviewDetail',
          data: {review_id:review_id},
          success:function(result){
            if(result.status==true){
              var review_media = result.data.review_media;
              
              $("textarea#edit_review_desc").val(result.data.review_content);
              $("input[name='editreviewUserName'][value='"+result.data.is_guest+"']").prop('checked',true);
              $("input[name='editreviewUserName']:checked").closest("span").addClass("checked");
              $("#updatemodalstar input[name='star'][value='"+result.data.review_rating+"']").prop('checked',true);
              $("input[name='editPageReviewId']").val(result.data.id);

              if(review_media!=''){

                var arr = review_media.split(',');
              for (var i = 0; i < arr.length; i++) {

                console.log(i);
                $("<div class='imageThumbDiv'><input type='hidden' name='images[]'' value='"+arr[i]+"' id='media-"+i+"'/><span class='imgblocks imgblock"+i+"'><img src='/uploads/"+arr[i]+"' height='65px' width='65px'><a href='javascript:void(0)' id='"+arr[i]+"' onclick='check("+i+",this)'><i class='fa fa-close' style='font-size:24px'></i></a></span></div>").appendTo("#dbreview_img");
              }

              $("<input type='hidden' name='db_editreviewimages' value='"+arr.length+"' id='db_editreviewimages'/>").insertAfter(".edit-media-section");

              }else{
              $("<input type='hidden' name='db_editreviewimages' value='0' id='db_editreviewimages'/>").insertAfter(".edit-media-section");                
              }
              $("#editReviewModel").modal();
            }
          }
        })
      });

        $('.delReview').click(function(){
          swal({
                title: "Are you sure you want to delete this review ?",
                icon: "warning",
                buttons: true,
                buttons: ["Cancel", "Delete"],
                dangerMode: true,
                closeOnClickOutside: false,
                closeOnEsc: false,
            })
            .then((willDelete) => {
                if (willDelete) {
                    window.location="../deletereview?review="+this.id;
                }
            });
        });

        $('.delreplyReview').click(function(){
          var rid = this.id;
          swal({
                title: "Are you sure you want to delete this reply ?",
                icon: "warning",
                buttons: true,
                buttons: ["Cancel", "Delete"],
                dangerMode: true,
                closeOnClickOutside: false,
                closeOnEsc: false,
            })
            .then((willDelete) => {
                if (willDelete) {
                    //window.location="../deletereplyreview?review="+this.id;
                    $.ajax({
                      method: 'post',
                      url:'/deletereplyreview',
                      data: {review_id:rid},
                      success:function(result){
                        if(result.status==true){
                          swal({
                              title: "Review reply deleted successfully",
                              icon: "success",
                              dangerMode: true,
                              closeOnClickOutside: false,
                              closeOnEsc: false,
                          }).then((value) => {
                            window.location.reload();
                          });                  
                        }
                      }
                    })
                }
            });
        });

        $('.ratingsForm #pagestar input[type="radio"]').click(function(){
          var page_rating = $('.ratingsForm #pagestar input[type="radio"]:checked').val();
          $('.ratingsForm #modalstar #addstar-1'+page_rating).prop('checked',true);
          var is_usertype = '<%-is_usertype%>';
          console.log(is_usertype);
          if(is_usertype==0){
            swal({
                title: "Login required to add review",
                icon: "warning",
                buttons: true,
                buttons: ["Cancel", "Login"],
                dangerMode: true,
                closeOnClickOutside: false,
                closeOnEsc: false,
            })
            .then((willDelete) => {
                if (willDelete) {
                    window.location.href = "/login";
                }else{
                  window.location.reload();
                }
            });
          }else if(is_usertype==2){
            swal({
                title: "Business user can't add review",
                icon: "error",
                dangerMode: true,
                closeOnClickOutside: false,
                closeOnEsc: false,
            }).then((value) => {
              //window.location.reload();
            });
          }else if(is_usertype==3){
            swal({
                title: "Admin user can't add review",
                icon: "error",
                dangerMode: true,
                closeOnClickOutside: false,
                closeOnEsc: false,
            }).then((value) => {
              //window.location.reload();
            });
          }else{
            var propertyId = $("#propId").val();
            $.ajax({
                method: 'get',
                url:'/checkforaddreview',
                data: {propertyId: propertyId},
               success:function(result){
                  if(result.status==true){                    
                    $("#addReviewModel").modal();
                  }else if(result.message=='hourlimit'){
                        swal({
                          title: "Sorry, You can give maximum 3 reviews in an hour",
                          icon: "error",
                          dangerMode: true,
                          closeOnClickOutside: false,
                          closeOnEsc: false,
                        })
                    }
                    else{
                      swal({
                        title: "Sorry, you can give one review to each property in month",
                        icon: "error",
                        dangerMode: true,
                        closeOnClickOutside: false,
                        closeOnEsc: false,
                      })
                    }
                }
              });
          }
        });

        $('.checkInbtn').click(function(){        
            var propertyId = $("#propId").val();
            $.ajax({
                method: 'get',
                url:'/checkforcheckin',
                data: {propertyId: propertyId},
               success:function(result){
                  if(result.status==true){                    
                    $('#CheckInModel').modal();
                  }else{
                    swal({
                      title: "Sorry, user can not checkin to multiple locations within 2 hours",
                      icon: "error",
                      dangerMode: true,
                      closeOnClickOutside: false,
                      closeOnEsc: false,
                    })
                  }
                }
              });
        });

        $('#addReviewform').submit(function(e){
            e.preventDefault();
            if(!($('#addReviewform').valid())){
              console.log('form is invalid');
            }
            else{
              $("#addReviewModel").modal("hide");
              var user_location = '';
            if(($("#user_location").val())!=''){
              user_location = $("#user_location").val();
            }
            var review_content = $("textarea#review_desc").val();
            var review_post_user = $("input[name='reviewUserName']:checked").val();
            var rating_number = $("#modalstar input[type='radio']:checked").val();
            var propertyId = $("#propId").val();  
            console.log(propertyId);
            var propId = $("#propertyId").val();
            console.log(propId);
            $(this).ajaxSubmit({ 
                data: {review_content: review_content,review_post_user:review_post_user,rating_number:rating_number,propertyId:propertyId,propId: propId,user_location:user_location},
                contentType: 'application/json',
                success: function(response){
                  swal({
                      title: "Your review was added successfully",
                      icon: "success",
                      dangerMode: true,
                      closeOnClickOutside: false,
                      closeOnEsc: false,
                  }).then((value) => {
                    window.location.reload();
                  });                  
                }
            });
            return false;
          }
        });

        $('#updateReviewform').submit(function(e){
            e.preventDefault();
            if(!($('#updateReviewform').valid())){
              console.log('form is invalid');
            }
            else{
              $("#editReviewModel").modal("hide");
            var review_content = $("textarea#edit_review_desc").val();
            var review_post_user = $("input[name='editreviewUserName']:checked").val();
            var rating_number = $("#updatemodalstar input[type='radio']:checked").val();
            var propertyId = $("#propId").val();
            $(this).ajaxSubmit({
                data: {review_content: review_content,review_post_user:review_post_user,rating_number:rating_number,prop_Id:propertyId},
                contentType: 'application/json',
                success: function(response){
                    swal({
                        title: "Review updated successfully",
                        icon: "success",
                        dangerMode: true,
                        closeOnClickOutside: false,
                        closeOnEsc: false,
                    }).then((value) => {
                      window.location.reload();
                    });
                    /*var msg = '';
                    if(response.status==true){
                        msg="<h2 class='post-title'>Review updated successfully</h2>";
                    }else{
                        msg="<h2 class='post-title'>Oops, something went wrong</h2>";
                    }
                    $("#updateReviewform #updatereviewres_msg").html(msg);
                    $("button#updateReview").hide();
                    $("button#updateclosebtn").show();*/
                }
            });
            return false;
          }
        });

        $(".pagination li").click(function(){
            $("#page").val($(this).attr('data-id'));
            $("#property-details").submit();
        });

        $("#claimBtn").click(function(){
            swal({
                title: "Are you sure you want to claim this location?",
                icon: "warning",
                buttons: true,
                buttons: ["Cancel", "Claim"],
                dangerMode: true,
                closeOnClickOutside: false,
                closeOnEsc: false,
                timer: 10000,
            })
            .then((willDelete) => {
                if (willDelete) {
                    window.location="../claimlocation?id="+$(this).attr('data-property-id');
                }
            });
          /*if(confirm("Are you sure you want to claim this location ?")){
            window.location="../claimlocation?id="+$(this).attr('data-property-id');
          }*/
        });

        $("#unClaimBtn").click(function(){
            swal({
                title: "Are you sure you want to unclaim this location?",
                icon: "warning",
                buttons: true,
                buttons: ["Cancel", "Unclaim"],
                dangerMode: true,
                closeOnClickOutside: false,
                closeOnEsc: false,
                timer: 10000,
            })
            .then((willDelete) => {
                if (willDelete) {
                    window.location="../unclaimlocation?id="+$(this).attr('data-property-id');
                }
            });
          /*if(confirm("Are you sure you want to unclaim this location ?")){
            window.location="../unclaimlocation?id="+$(this).attr('data-property-id');
          }*/
        });      

        $(".flagThis").click(function(){
            $this=$(this);            
            if($this.attr('data-status')==0){
              var review_id = $this.attr('data-reviewId');
              var property_id = $this.attr('data-propertyId');
              $.ajax({
                method: 'post',
                url:'/admin/review/manageFlag',
                data: {review_id:review_id, status:1,property_id:property_id},
                success:function(result){
                  console.log(result);
                  $this.addClass('active');
                  $this.attr('data-status',1);
                }
              })
            }else{
              var review_id = $this.attr('data-reviewId');
              var property_id = $this.attr('data-propertyId');
              var flag_id =$this.attr('data-flagId');
               $.ajax({
                method: 'post',
                url:'/admin/review/manageFlag',
                data: {review_id:review_id, status:0,property_id:property_id},
                success:function(result){
                  console.log(result);
                  $this.removeClass('active');
                  $this.attr('data-status',0);
                }
              })
            }
        });

        $(".foundHelpful").click(function(){
          $this=$(this);            
            if($this.attr('data-status')==0){
              var review_id = $this.attr('data-reviewId');
              var property_id = $this.attr('data-propertyId');
              $.ajax({
                method: 'post',
                url:'/admin/review/manageLike',
                data: {review_id:review_id, status:1,property_id:property_id},
                success:function(result){
                  console.log(result);
                  $this.addClass('active');
                  $this.attr('data-status',1);
                }
              })
            }else{
              var review_id = $this.attr('data-reviewId');
              var property_id = $this.attr('data-propertyId');
              var flag_id =$this.attr('data-flagId');
               $.ajax({
                method: 'post',
                url:'/admin/review/manageLike',
                data: {review_id:review_id, status:0,property_id:property_id},
                success:function(result){
                  console.log(result);
                  $this.removeClass('active');
                  $this.attr('data-status',0);
                }
              })
            }
        });
      });



    function PostReply(a){  
      var replytext = ($("#reply"+a.id).val());
      if(replytext!=''){
        $.ajax({
            type: "POST",
            url: '/postreply',
            data: {'text':replytext,'review_id':a.id},
            success: function(data){
               window.location.reload();
            }
        });
      }  
    }

    function check(index,i){
      console.log(index);
      $("#media-"+index).remove();
      $("#dbreview_img span.imgblock"+index).remove();
      $("#db_editreviewimages").val( parseInt($("#db_editreviewimages").val()) - 1 );
      console.log($("#db_editreviewimages").val());
    }

    function SetOrigin(a){
      //alert(($("#originprop").data("media")));
      //($("#originprop").data("media", "yes change you atribute"));
      //alert(a);
    } 
    
      /*add radio button class*/
        $('.post-title input[type=radio]').click(function(){
          $('.post-title input[type=radio]').parent().removeClass('checked');
              $(this).parent().addClass('checked');
         });  
       /*file upload*/
           if(window.File && window.FileList && window.FileReader) {
               $("#addfiles").on("change",function(e) {
                $(".adduploadimg img.imageThumb").detach();
               var files = e.target.files ,
               filesLength = files.length ;
               for (var i = 0; i < filesLength ; i++) {
               var f = files[i]
               var fileReader = new FileReader();
               fileReader.onload = (function(e) {
               var file = e.target;
               $("<img></img>",{
               class : "imageThumb",
               src : e.target.result,
               title : file.name
               }).appendTo(".adduploadimg");
               });
               fileReader.readAsDataURL(f);
               }
          });
        } else { //alert("Your browser doesn't support to File API")
          swal({
              title: "Your browser doesn't support to File API",
              icon: "error",
              dangerMode: true,
              closeOnClickOutside: false,
              closeOnEsc: false,
          });
      }

        if(window.File && window.FileList && window.FileReader) {
               $("#editfiles").on("change",function(e) {
                $(".edituploadimg img.imageThumb").detach();
               var files = e.target.files ,
               filesLength = files.length ;
               for (var i = 0; i < filesLength ; i++) {
               var f = files[i]
               var fileReader = new FileReader();
               fileReader.onload = (function(e) {
               var file = e.target;
               $("<img></img>",{
               class : "imageThumb",
               src : e.target.result,
               title : file.name
               }).appendTo(".edituploadimg");
               });
               fileReader.readAsDataURL(f);
               }
          });
        } else { //alert("Your browser doesn't support to File API")
            swal({
              title: "Your browser doesn't support to File API",
              icon: "error",
              dangerMode: true,
              closeOnClickOutside: false,
              closeOnEsc: false,
            })
        }
         (function(e,t,n){var r=e.querySelectorAll("html")[0];r.className=r.className.replace(/(^|\s)no-js(\s|$)/,"$1js$2")})(document,window,0);
    </script>
  </body>
</html>
